#include <ESP8266WiFi.h>
#include<WiFiClient.h>
#include <ESP8266WebServer.h>
#include <ESP8266HTTPClient.h>

ESP8266WebServer server(80);
 

const char* ssid = "Home automation";
const char* password = "7599401502";
 
void setup () {
  
  Serial.begin(115200);
  IPAddress router_local_IP(192,168,10,2);//your router IP ( 192.168.0.x, or 192.168.1.x). Make sure your chosen static IP matches those first 3
  IPAddress router_dns(192,168,10,1);
  IPAddress router_gateway(192,168,10,1);
  IPAddress router_subnet(255,255,255,0);
  WiFi.config(router_local_IP,router_gateway,router_subnet,router_dns);
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.print("Connecting..");
 
  }

  server.on("/appliance_control",HTTP_POST,Appliance_control);
  server.begin();
   //RELAY IN PINs
  pinMode(16, OUTPUT);//D0
  pinMode(5, OUTPUT);//D1
  pinMode(4, OUTPUT);//D2
  pinMode(0, OUTPUT);//D3
  pinMode(2, OUTPUT);//D4
  
  //RELAY VCC PINs
  pinMode(14, OUTPUT);//D5
  pinMode(12, OUTPUT);//D6
  pinMode(13, OUTPUT);//D7
  pinMode(15, OUTPUT);//D8


  digitalWrite(14, HIGH);
  digitalWrite(12, HIGH);
  digitalWrite(13, HIGH);
  digitalWrite(15, HIGH); 
}
void Appliance_control(){
    if(!(server.hasArg("appliance_number") && server.hasArg("isChecked"))
      || (server.arg("appliance_number") == NULL && server.arg("isChecked") == NULL)) { 
      server.send(400, "text/plain", "400: Invalid Request");         // The request is invalid, so send HTTP status 400
      return;
    }

    String appliance_number= server.arg("appliance_number");
    String isOn=server.arg("isChecked");
    int pin_arr[]={16,5,4,0,2};
    
    if(isOn.equals("true")){
      digitalWrite(pin_arr[appliance_number.toInt()],HIGH);
    }
    else{
      digitalWrite(pin_arr[appliance_number.toInt()],LOW);
    }
  
    server.send(200, "text/html",""+appliance_number+isOn);
  
}
 
void loop() {
  server.handleClient();
  delay(1000);    //Send a request every 30 seconds
}